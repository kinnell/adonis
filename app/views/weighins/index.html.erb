<% if user_signed_in? %>

  <div id="content" class="span11">
    <div class="container">
      

      <h1>
        Weigh-Ins (<%= current_user.name %>)
        <button class="btn btn-primary btn-success" style="float: right" data-toggle="modal" data-target="#addWeighin"><span class="fa fa-plus"></span> New Weigh-In</button>
      </h1>

      <%= render 'modalform' %>  

      <%= content_tag :div, "", id: "weight_chart", data: {weighins: current_user.weighins} %>

      <br>

      <table class="table table-hover table-bordered table-center">
        <thead>
          <tr style="background-color: #eeeeee">
            <th>#</th>
            <th style="text-align: left">Date</th>
            <th>Weight</th>
            <th>Weigh-In Type</th>
            <th>Change Since Previous Weigh-In</th>
            <th>Change Since First Weigh-In</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% current_user.weighins.each do |weighin| %>
            <tr> 
                
                <td><%= weighin.weighinNum %></td>
                <td style="text-align: left"><%= weighin.printCreatedAt %></td>
                <td><%= weighin.weight %> lbs</td>
                <td>
                    <% if weighin.verified? %>
                        <span class="label label-success">Verified</span>
                    <% else %>
                        <span class="label label-info">Personal</span>
                    <% end %>
                </td>
                <td><%= weighin.printWeightChange %></td>
                <td><%= weighin.printWeightTotalChange %></td>
                <td>

                  <% if current_user.admin? %> 
                    <% if weighin.verified? %>
                        <%= link_to unverify_weighin_path(weighin), class: "btn-small btn btn-success" do %><i class="fa fa-check-square-o"></i><% end %>
                    <% else %>
                        <%= link_to verify_weighin_path(weighin), class: "btn-small btn btn-success" do %><i class="fa fa-square-o"></i><% end %>
                    <% end %>                
                    
                    <%= link_to edit_weighin_path(weighin), class: "btn-small btn btn-info" do %><i class="fa fa-edit"></i><% end %>

                    <%= link_to weighin, class: "btn-small btn btn-danger", method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fa fa-trash-o "></i><% end %>
                  
                  <% else %>

                    <% unless weighin.verified? %>
                      <%= link_to weighin, class: "btn-small btn btn-danger", method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fa fa-trash-o "></i><% end %>
                    <% end %>

                  <% end %>
                  
                </td>
            </tr>

          <% end %>
          
        </tbody>
      </table>

<%= content_tag :div, "", id: "percent_chart", data: {weighins: Weighin.allWeightPercentTotalChanges(current_user)} %>

      <table class="table table-hover table-bordered table-center">
        <thead>
          <tr style="background-color: #eeeeee">
            <th>Date</th>
            <th>Change Since First Weigh-In</th>
          </tr>
        </thead>

        <tbody>
          <% @weighins.allWeightPercentTotalChanges(current_user).each do |weightChange| %>
            <tr> 
                
                <td><%= weightChange[:created_at] %>%</td>               
                <td><%= weightChange[:percent_change] %>%</td>
               
            </tr>

          <% end %>
          
        </tbody>
      </table>


 
        <br>

      </div>

  </div>



<% else %>
<div class="frontBackground">

<div class="frontLogo">eCWellness: <font face="Rock Salt" color="#f4f4f6">The Biggest Loser</font>
<br><br><br><br>


<%= link_to new_user_registration_path, class: "btn btn-large" do %>
                  <span class="fa fa-magic"></span>  Register<% end %>
           
                <%= link_to new_user_session_path, class: "btn btn-large" do %>
                <span class="fa fa-key"></span>  Login<% end %>


                
              </div>
             

</div>
<% end %>



