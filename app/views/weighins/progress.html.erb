<% if user_signed_in? %>

  <div id="content" class="span11">
    <div class="container">
      

      <h1><i class="fa fa-bar-chart-o"></i> My Progress</h1>

      <button class="btn btn-primary btn-success" style="float: right" data-toggle="modal" data-target="#addWeighin"><span class="fa fa-plus"></span> New Weigh-In</button>

      <%= render 'modalform' %>  

<hr>
<center><h2><b>Weight Change</b></h2></center>

      <%= content_tag :div, "", id: "weight_chart", data: {weighins: current_user.weighins} %>

      <br>

      <table class="table table-hover table-bordered table-center">
        <thead>
          <tr style="background-color: #eeeeee">
            <th>#</th>
            <th style="text-align: left">Date</th>
            <th>Weight</th>
            <th>Change Since Previous Weigh-In</th>
            <th>Change Since First Weigh-In</th>
            <th>Weigh-In Type</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% current_user.weighins.each do |weighin| %>
            <tr> 
                
                <td><%= weighin.weighinNum %></td>
                <td style="text-align: left"><%= weighin.printCreatedAt %></td>
                <td><%= weighin.weight %> lbs</td>
                
                <td><%= weighin.printWeightChange %></td>
                <td><%= weighin.printWeightTotalChange %></td>
                <td>
                    <% if weighin.verified? %>
                        <span class="label label-success">Verified</span>
                    <% else %>
                        <span class="label label-info">Personal</span>
                    <% end %>
                </td>
                <td>

                  <% if current_user.admin? %> 
                    <% if weighin.verified? %>
                        <%= link_to unverify_weighin_path(weighin), class: "btn-small btn btn-success" do %><i class="fa fa-check-square-o"></i><% end %>
                    <% else %>
                        <%= link_to verify_weighin_path(weighin), class: "btn-small btn btn-success" do %><i class="fa fa-square-o"></i><% end %>
                    <% end %>                
                    
                    <%= link_to edit_weighin_path(weighin), class: "btn-small btn btn-info" do %><i class="fa fa-edit"></i><% end %>

                    <%= link_to weighin, class: "btn-small btn btn-danger", method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fa fa-trash-o "></i><% end %>
                  
                  <% else %>

                    <% unless weighin.verified? %>
                      <%= link_to weighin, class: "btn-small btn btn-danger", method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fa fa-trash-o "></i><% end %>
                    <% end %>

                  <% end %>
                  
                </td>
            </tr>

          <% end %>
          
        </tbody>
      </table>

<br>
<hr>
<center><h2><b>Percent Change from Initial Weigh-in</b></h2></center>
<%= content_tag :div, "", id: "percent_chart", data: {weighins: Weighin.allWeightPercentTotalChanges(current_user)} %>

      <table class="table table-hover table-bordered table-center">
        <thead>
          <tr style="background-color: #eeeeee">
            <th>#</th>
            <th style="text-align: left">Date</th>
            <th>Change Since First Weigh-In</th>
          </tr>
        </thead>
        <tbody>
          <% @weighins.allWeightPercentTotalChanges(current_user).each_with_index do |percentChange,i| %>
              <tr>    
                  <td><%= i+1 %></td>             
                  <td style="text-align: left"><%= percentChange[:created_at].strftime("%A, %B %-d, %Y %-I:%M %p") %></td>               
                  <td><%= percentChange[:percent_change] %>%</td>
              </tr>
          <% end %>          
        </tbody>
      </table>


 
        <br>

      </div>

  </div>



<% end %>



